import pg from 'pg';

export type SelectJson13Result = {
	json_object_agg: Record<string, string | undefined>;
}

export async function selectJson13(client: pg.Client | pg.Pool | pg.PoolClient): Promise<SelectJson13Result[]> {
	const sql = `
	SELECT
		json_object_agg(int4_column, date_column)
	FROM all_types t
	GROUP BY int4_column
	`
	return client.query({ text: sql, rowMode: 'array' })
		.then(res => res.rows.map(row => mapArrayToSelectJson13Result(row)));
}

function mapArrayToSelectJson13Result(data: any) {
	const result: SelectJson13Result = {
		json_object_agg: data[0]
	}
	return result;
}